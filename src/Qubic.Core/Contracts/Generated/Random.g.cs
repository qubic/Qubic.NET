// <auto-generated>
// Generated by Qubic.ContractGen from Random.h.
// Do not edit manually. Re-run the generator after updating deps/qubic-core.
// </auto-generated>

using System.Buffers.Binary;
using Qubic.Core.Contracts;
using Qubic.Core.Payloads;

namespace Qubic.Core.Contracts.Random;

/// <summary>Random contract (index 3).</summary>
public static class RandomContract
{
    /// <summary>Contract index on the Qubic network.</summary>
    public const int ContractIndex = 3;

    /// <summary>Gets the 32-byte contract public key.</summary>
    public static byte[] GetPublicKey() => QubicContracts.GetContractPublicKey(ContractIndex);

    /// <summary>State-mutating procedure IDs.</summary>
    public static class Procedures
    {
        /// <summary>RevealAndCommit (inputType=1).</summary>
        public const uint RevealAndCommit = 1;
    }
}

// ═══ Procedure: RevealAndCommit (inputType=1) ═══

/// <summary>Input payload for procedure.</summary>
public sealed class RevealAndCommitPayload : ITransactionPayload, ISmartContractInput
{
    public const int Size = 4128;

    public ushort InputType => 1;
    public ushort InputSize => Size;
    public int SerializedSize => Size;

    public bool[] RevealedBits { get; init; }
    public required byte[] CommittedDigest { get; init; }

    public byte[] GetPayloadBytes() => ToBytes();

    public byte[] ToBytes()
    {
        var bytes = new byte[Size];
        for (int i = 0; i < 4096 && RevealedBits != null && i < RevealedBits.Length; i++)
        {
            bytes.AsSpan(0 + i * 1)[0] = (byte)(RevealedBits[i] ? 1 : 0);
        }
        CommittedDigest.AsSpan(0, 32).CopyTo(bytes.AsSpan(4096));
        return bytes;
    }
}

/// <summary>Output (empty).</summary>
public readonly struct RevealAndCommitOutput : ISmartContractOutput<RevealAndCommitOutput>
{
    public static RevealAndCommitOutput FromBytes(ReadOnlySpan<byte> data) => new();
}
